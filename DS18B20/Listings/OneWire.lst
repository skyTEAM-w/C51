C51 COMPILER V9.60.0.0   ONEWIRE                                                           02/10/2022 16:56:09 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE ONEWIRE
OBJECT MODULE PLACED IN .\Objects\OneWire.obj
COMPILER INVOKED BY: D:\Program files\Keil\C51\BIN\C51.EXE OneWire.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.
                    -\Listings\OneWire.lst) TABS(2) OBJECT(.\Objects\OneWire.obj)

line level    source

   1          #include <REGX52.H>
   2          
   3          sbit OneWire_DQ = P3 ^ 7;
   4          
   5          /**
   6           * @brief 单总线初始化函数
   7           * 
   8           * @return unsigned char 
   9           * @retval 0为初始化成功，1为失败
  10           */
  11          unsigned char OneWire_Init()
  12          {
  13   1          unsigned char i;
  14   1          unsigned char AckBit;
  15   1          OneWire_DQ = 1;
  16   1          OneWire_DQ = 0;
  17   1      
  18   1          //Delay500us
  19   1        i = 247;
  20   1        while (--i);
  21   1      
  22   1          OneWire_DQ = 1;
  23   1      
  24   1          //Delay70us
  25   1          i = 32;
  26   1        while (--i);
  27   1      
  28   1          AckBit = OneWire_DQ;
  29   1      
  30   1          //Delay500us
  31   1        i = 247;
  32   1        while (--i);
  33   1      
  34   1          return AckBit;
  35   1      }
  36          
  37          /**
  38           * @brief 单总线发送一位
  39           * 
  40           * @param Bit 发送的位
  41           */
  42          void OneWire_SendBit(unsigned char Bit)
  43          {
  44   1          unsigned char i = 0;
  45   1          OneWire_DQ = 0;
  46   1      
  47   1          //Delay10us
  48   1          i = 4;
  49   1        while (--i);
  50   1      
  51   1          OneWire_DQ = Bit;
  52   1      
  53   1          //Delay50us
  54   1          i = 24;
C51 COMPILER V9.60.0.0   ONEWIRE                                                           02/10/2022 16:56:09 PAGE 2   

  55   1        while (--i);
  56   1      
  57   1          OneWire_DQ = 1;
  58   1      }
  59          
  60          /**
  61           * @brief 单总线接收一位
  62           * 
  63           * @return unsigned char 接收的一位 
  64           */
  65          unsigned char OneWire_ReceiveBit()
  66          {
  67   1          unsigned char Bit;
  68   1          unsigned char i = 0;
  69   1      
  70   1          OneWire_DQ = 0;
  71   1          i = 2; // Delay5us
  72   1          while (--i);
  73   1          OneWire_DQ = 1;
  74   1          i = 2; // Delay5us
  75   1          while (--i);
  76   1          Bit = OneWire_DQ;
  77   1          i = 22; //Delay50us
  78   1        while (--i);
  79   1      
  80   1          return Bit;
  81   1      }
  82          
  83          /**
  84           * @brief 单总线发送一个字节
  85           * 
  86           * @param Byte 发送的一个字节
  87           */
  88          void OneWire_SendByte(unsigned char Byte)
  89          {
  90   1          unsigned char i;
  91   1          for(i = 0; i < 8; i++)
  92   1          {
  93   2              OneWire_SendBit(Byte & (0x01 << i));
  94   2          }
  95   1      }
  96          
  97          /**
  98           * @brief 单总线接收一个字节
  99           * 
 100           * @return unsigned char 接收的一个字节
 101           */
 102          unsigned char OneWire_ReceiveByte()
 103          {
 104   1          unsigned char Byte = 0x00;
 105   1          unsigned char i;
 106   1      
 107   1          for(i = 0; i < 8; i++)
 108   1          {
 109   2              if(OneWire_ReceiveBit())
 110   2              {
 111   3                  Byte |= 0x01 << i;
 112   3              }
 113   2          }
 114   1      
 115   1          return Byte;
 116   1      }
C51 COMPILER V9.60.0.0   ONEWIRE                                                           02/10/2022 16:56:09 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    142    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
